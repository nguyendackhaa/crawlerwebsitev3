<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title|default('CrawlBot - Công cụ thu thập dữ liệu sản phẩm') }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/file-upload.css') }}">
    <!-- Script trước đây đã được chuyển sang file riêng -->
</head>
<body>
    <div class="container">
        <div class="main-container">
        <h1 class="text-center mb-4">CrawlBot</h1>
            <p class="text-center mb-4">Công cụ thu thập dữ liệu sản phẩm từ website</p>
            
            <!-- Thông báo thành công -->
            <div id="success-alert" class="alert alert-success" {% if not success_message %}style="display: none;"{% endif %}>
                {{ success_message }}
                {% if download_url %}
                <div class="mt-2">
                    <a href="{{ download_url }}" class="btn btn-success btn-sm">
                        <i class="bi bi-download"></i> Tải xuống kết quả
                    </a>
                </div>
                {% endif %}
            </div>

        {% if error %}
        <div class="alert alert-danger">
            {{ error }}
        </div>
        {% endif %}

        <!-- Thanh tiến trình -->
        <div id="progress-container" class="mt-3 d-none">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Tiến trình cào dữ liệu</h5>
                </div>
                <div class="card-body">
                    <div class="progress mb-3">
                        <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">0%</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="alert alert-info mb-2">
                                <span id="progress-message">Đang khởi động...</span>
                            </div>
                            <div class="card bg-light">
                                <div class="card-body py-2">
                                    <small id="progress-detail" class="text-muted">Đang chuẩn bị...</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Thêm thống kê chi tiết -->
                    <div class="mt-3">
                        <h6>Thống kê tiến trình:</h6>
                        <table class="table table-sm table-bordered">
                            <tr>
                                <td width="50%"><small>Trạng thái</small></td>
                                <td width="50%"><small id="progress-status">Đang chuẩn bị</small></td>
                            </tr>
                            <tr>
                                <td><small>Thời gian đã chạy</small></td>
                                <td><small id="progress-time">0s</small></td>
                            </tr>
                            <tr>
                                <td><small>Tốc độ xử lý</small></td>
                                <td><small id="progress-speed">-</small></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                    <button class="nav-link {% if active_tab == 'extract-tab' or not active_tab %}active{% endif %}" id="extract-tab" data-bs-toggle="tab" data-bs-target="#extract" type="button" role="tab" aria-controls="extract" aria-selected="{% if active_tab == 'extract-tab' or not active_tab %}true{% else %}false{% endif %}">
                    1. Thu thập liên kết sản phẩm
                </button>
            </li>
            <li class="nav-item" role="presentation">
                    <button class="nav-link {% if active_tab == 'scrape-tab' %}active{% endif %}" id="scrape-tab" data-bs-toggle="tab" data-bs-target="#scrape" type="button" role="tab" aria-controls="scrape" aria-selected="{% if active_tab == 'scrape-tab' %}true{% else %}false{% endif %}">
                    2. Thu thập thông tin sản phẩm
                </button>
            </li>
            <li class="nav-item" role="presentation">
                    <button class="nav-link {% if active_tab == 'images-tab' %}active{% endif %}" id="images-tab" data-bs-toggle="tab" data-bs-target="#images" type="button" role="tab" aria-controls="images" aria-selected="{% if active_tab == 'images-tab' %}true{% else %}false{% endif %}">
                    3. Tải ảnh sản phẩm Autonics
                </button>
            </li>
            <li class="nav-item" role="presentation">
                    <button class="nav-link {% if active_tab == 'view-images-tab' %}active{% endif %}" id="view-images-tab" data-bs-toggle="tab" data-bs-target="#view-images" type="button" role="tab" aria-controls="view-images" aria-selected="{% if active_tab == 'view-images-tab' %}true{% else %}false{% endif %}">
                    4. Chuyển đổi ảnh JPG sang WebP THỰC SỰ
                </button>
            </li>
            <li class="nav-item" role="presentation">
                    <button class="nav-link {% if active_tab == 'jpg-download-tab' %}active{% endif %}" id="jpg-download-tab" data-bs-toggle="tab" data-bs-target="#jpg-download" type="button" role="tab" aria-controls="jpg-download" aria-selected="{% if active_tab == 'jpg-download-tab' %}true{% else %}false{% endif %}">
                    5. Tải ảnh chất lượng cao (JPG)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pdf-download-tab" data-bs-toggle="tab" data-bs-target="#pdf-download" type="button" role="tab" aria-controls="pdf-download" aria-selected="false">
                    6. Tải tài liệu PDF sản phẩm từ URL BAA.vn
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="baa-images-tab" data-bs-toggle="tab" data-bs-target="#baa-images" type="button" role="tab" aria-controls="baa-images" aria-selected="false">
                    7. Tải ảnh sản phẩm từ BAA.vn
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if active_tab == 'image-upscale-tab' %}active{% endif %}" id="image-upscale-tab" data-bs-toggle="tab" data-bs-target="#image-upscale" type="button" role="tab" aria-controls="image-upscale" aria-selected="{% if active_tab == 'image-upscale-tab' %}true{% else %}false{% endif %}">
                    <i class="bi bi-image-alt"></i> Nâng cao chất lượng ảnh (AI)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="category-baa-images-tab" data-bs-toggle="tab" data-bs-target="#category-baa-images" type="button" role="tab" aria-controls="category-baa-images" aria-selected="false">
                    <i class="bi bi-folder-symlink"></i> Tải ảnh từ nhiều danh mục
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="compare-products-tab" data-bs-toggle="tab" data-bs-target="#compare-products" type="button" role="tab" aria-controls="compare-products" aria-selected="false">
                    <i class="bi bi-bar-chart-line"></i> So sánh mã sản phẩm
                </button>
            </li>
            <li class="nav-item" role="presentation">
                    <button class="nav-link {% if active_tab == 'filter-products-tab' %}active{% endif %}" id="filter-products-tab" data-bs-toggle="tab" data-bs-target="#filter-products" type="button" role="tab" aria-controls="filter-products" aria-selected="{% if active_tab == 'filter-products-tab' %}true{% else %}false{% endif %}">
                    <i class="bi bi-funnel"></i> Lọc mã sản phẩm
                </button>
            </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link {% if active_tab == 'filter-product-types-tab' %}active{% endif %}" id="filter-product-types-tab" data-bs-toggle="tab" data-bs-target="#filter-product-types" type="button" role="tab" aria-controls="filter-product-types" aria-selected="{% if active_tab == 'filter-product-types-tab' %}true{% else %}false{% endif %}">
                        <i class="bi bi-funnel"></i> Lọc theo loại
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="extract-prices-tab" data-bs-toggle="tab" data-bs-target="#extract-prices" type="button" role="tab" aria-controls="extract-prices" aria-selected="false">
                    <i class="bi bi-currency-exchange"></i> Trích xuất giá sản phẩm
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="extract-only-prices-tab" data-bs-toggle="tab" data-bs-target="#extract-only-prices" type="button" role="tab" aria-controls="extract-only-prices" aria-selected="false">
                    <i class="bi bi-cash-coin"></i> Chỉ lấy giá sản phẩm
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="category-extract-tab" data-bs-toggle="tab" data-bs-target="#category-extract" type="button" role="tab" aria-controls="category-extract" aria-selected="false">
                    <i class="bi bi-folder-plus"></i> Cào nhiều danh mục (Liên kết)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="codienhaiau-crawler-tab" data-bs-toggle="tab" data-bs-target="#codienhaiau-crawler" type="button" role="tab" aria-controls="codienhaiau-crawler" aria-selected="false">
                    <i class="bi bi-globe"></i> Cào dữ liệu Codienhaiau.com
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="baa-crawler-tab" data-bs-toggle="tab" data-bs-target="#baa-crawler" type="button" role="tab" aria-controls="baa-crawler" aria-selected="false">
                    <i class="bi bi-globe"></i> Cào dữ liệu BAA.vn
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="categorize-products-tab" data-bs-toggle="tab" data-bs-target="#categorize-products" type="button" role="tab" aria-controls="categorize-products" aria-selected="false">
                    <i class="bi bi-folder-symlink"></i> Phân loại sản phẩm theo danh mục
                </button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <!-- Tab thu thập liên kết sản phẩm -->
            <div class="tab-pane fade show active" id="extract" role="tabpanel" aria-labelledby="extract-tab">
                <div class="form-container">
                    <h4 class="mb-3">Thu thập liên kết sản phẩm từ danh mục</h4>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tạo một file <strong>TXT</strong> chứa danh sách các đường link danh mục sản phẩm (mỗi link trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Tải file TXT lên hệ thống</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Thu thập liên kết" để bắt đầu quá trình thu thập</p>
                        </div>
                    </div>
                    
                    <form action="{{ url_for('main.extract_links') }}" method="post" enctype="multipart/form-data" class="mt-4">
                        <label for="link_file" class="file-input-label">
                            <i class="bi bi-cloud-arrow-up fs-1"></i>
                            <span>Chọn file TXT chứa danh sách URL danh mục</span>
                        </label>
                        <input type="file" name="link_file" id="link_file" style="display: none;" accept=".txt" onchange="updateFileName(this, 'link_file_name')">
                        <div id="link_file_name" class="mb-3"></div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-link-45deg"></i> Thu thập liên kết
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tab thu thập thông tin sản phẩm -->
            <div class="tab-pane fade" id="scrape" role="tabpanel" aria-labelledby="scrape-tab">
                <div class="form-container">
                    <h4 class="mb-3">Thu thập thông tin sản phẩm từ liên kết</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin được trích xuất</h5>
                        <p>Hệ thống sẽ tự động trích xuất các thông tin sau:</p>
                        <ol>
                            <li><strong>STT</strong>: Số thứ tự tự động tăng</li>
                            <li><strong>Mã sản phẩm</strong>: Mã được lấy từ các thẻ có class như "product__symbol__value", "sku", v.v.</li>
                            <li><strong>Tên sản phẩm</strong>: Tên được lấy từ thẻ h1 có class như "product__name", v.v.</li>
                            <li><strong>Tổng quan</strong>: Bảng thông số kỹ thuật được định dạng HTML</li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tải lên file <strong>TXT</strong> chứa danh sách các đường link sản phẩm (kết quả từ bước 1 hoặc file tự tạo, mỗi link trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Tải lên file <strong>Excel</strong> mẫu chứa tiêu đề các cột thông tin cần thu thập</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Thu thập thông tin" để bắt đầu quá trình thu thập</p>
                        </div>
                    </div>

                    <form action="/scrape-products" method="post" enctype="multipart/form-data" id="scrape-form">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="product_link_file" class="file-input-label">
                                        <i class="bi bi-file-earmark-text fs-3"></i>
                                        <div class="mt-2">File .txt chứa URL sản phẩm</div>
                                        <span>Mỗi URL trên một dòng</span>
                                        <input type="file" id="product_link_file" name="product_link_file" class="d-none" accept=".txt" onchange="updateFileName(this, 'product_link_file_name')">
                                </label>
                                <div id="product_link_file_name" class="mb-3 text-muted"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="excel_template" class="file-input-label">
                                    <i class="bi bi-file-earmark-excel fs-3"></i>
                                        <div class="mt-2">File mẫu Excel (nếu có)</div>
                                    <span>Chỉ chấp nhận file .xlsx, .xls</span>
                                        <input type="file" id="excel_template" name="excel_template" class="d-none" accept=".xlsx, .xls" onchange="updateFileName(this, 'excel_template_name')">
                                </label>
                                <div id="excel_template_name" class="mb-3 text-muted"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Thu thập thông tin sản phẩm</button>
                    </form>
                </div>
            </div>

            <!-- Tab tải ảnh sản phẩm Autonics -->
            <div class="tab-pane fade" id="images" role="tabpanel" aria-labelledby="images-tab">
                <div class="form-container">
                    <h4 class="mb-3">Tải ảnh sản phẩm từ website Autonics</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này sẽ tự động tìm kiếm và tải ảnh sản phẩm từ trang web Autonics dựa trên mã sản phẩm:</p>
                        <ol>
                            <li>Đọc danh sách mã sản phẩm từ file TXT</li>
                            <li>Tự động tìm kiếm sản phẩm trên website <a href="https://www.autonics.com/vn/main" target="_blank">Autonics</a></li>
                            <li>Trích xuất và tải ảnh sản phẩm</li>
                            <li>Lưu tất cả ảnh trong một thư mục và nén lại thành file ZIP để tải xuống</li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tạo một file <strong>TXT</strong> chứa danh sách mã sản phẩm Autonics (mỗi mã sản phẩm trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Tải file TXT lên hệ thống</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Tải ảnh sản phẩm" để bắt đầu quá trình tìm kiếm và tải ảnh</p>
                        </div>
                    </div>

                    <form action="/download-images" method="post" enctype="multipart/form-data" id="images-form">
                        <label for="product_code_file" class="file-input-label">
                                <i class="bi bi-file-earmark-text fs-3"></i>
                                <div class="mt-2">File .txt chứa mã sản phẩm</div>
                                <span>Mỗi mã sản phẩm trên một dòng</span>
                                <input type="file" id="product_code_file" name="product_code_file" class="d-none" accept=".txt" onchange="updateFileName(this, 'product_code_file_name')">
                        </label>
                        <div id="product_code_file_name" class="mb-3 text-muted"></div>
                        <button type="submit" class="btn btn-primary w-100">Tải ảnh sản phẩm</button>
                    </form>
                </div>
            </div>

            <!-- Tab xem ảnh đã tải xuống -->
            <div class="tab-pane fade" id="view-images" role="tabpanel" aria-labelledby="view-images-tab">
                <div class="form-container">
                    <h4 class="mb-3">Chuyển đổi ảnh JPG sang WebP THỰC SỰ</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này chuyển đổi ảnh sang định dạng WebP <strong>THỰC SỰ</strong> với các đảm bảo:</p>
                        <ol>
                            <li>✅ <strong>Định dạng file là .webp</strong> - Đuôi file chính xác</li>
                            <li>✅ <strong>Nội dung ảnh là WebP thực sự</strong> - Kiểm tra file signature RIFF/WEBP</li>
                            <li>✅ <strong>MIME type chính xác</strong> - image/webp, không phải image/jpeg đội lốt</li>
                            <li>✅ <strong>Tương thích hoàn toàn</strong> - Không bị WordPress, trình duyệt hoặc bất kỳ plugin nào (ShortPixel, Imagify...) hiểu nhầm</li>
                            <li>✅ <strong>Nén tối ưu</strong> - Sử dụng thuật toán nén WebP tốt nhất (method 6)</li>
                            <li>✅ <strong>Báo cáo chi tiết</strong> - File Excel với thông tin xác minh cho từng ảnh</li>
                        </ol>
                        <div class="alert alert-success mt-3">
                            <i class="bi bi-shield-check me-2"></i>
                            <strong>Đảm bảo 100%:</strong> Mọi file output đều được kiểm tra nghiêm ngặt bằng 3 phương pháp:
                            <ul class="mb-0 mt-2">
                                <li>Kiểm tra file signature (12 bytes đầu: RIFF + WEBP)</li>
                                <li>Kiểm tra MIME type thực tế của file</li>
                                <li>Xác minh format qua thư viện xử lý ảnh PIL</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Chọn các file ảnh cần chuyển đổi (JPG, JPEG, PNG, GIF, BMP, TIFF)</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Chuyển đổi sang WebP THỰC SỰ" để bắt đầu quá trình</p>
                        </div>
                        <div class="step">
                            <p>Tải xuống file ZIP chứa ảnh WebP đã được xác minh và báo cáo chi tiết</p>
                        </div>
                    </div>

                    <form action="/convert-to-webp" method="post" enctype="multipart/form-data" id="convert-form">
                        <label for="image_files" class="file-input-label">
                                <i class="bi bi-file-earmark-image fs-3"></i>
                                <div class="mt-2">Tải lên hình ảnh cần chuyển đổi sang WebP THỰC SỰ</div>
                                <span>Chấp nhận: .jpg, .jpeg, .png, .gif, .bmp, .webp, .tiff, .tif</span>
                                <input type="file" id="image_files" name="image_files" class="d-none" accept=".jpg,.jpeg,.png,.gif,.bmp,.webp,.tiff,.tif" multiple onchange="updateFileNameMultiple(this, 'image_files_name')">
                        </label>
                        <div id="image_files_name" class="mb-3 text-muted"></div>
                        
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> <strong>Lưu ý:</strong> 
                            <ul class="mb-0">
                                <li>Chất lượng output: 90% (cân bằng giữa chất lượng và kích thước)</li>
                                <li>Phương pháp nén: Tối ưu nhất (method 6)</li>
                                <li>Hỗ trợ cả ảnh có nền trong suốt (RGBA)</li>
                                <li>Mỗi file sẽ được kiểm tra kỹ lưỡng trước khi đóng gói</li>
                            </ul>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-shield-check me-2"></i>Chuyển đổi sang WebP THỰC SỰ
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tab tải ảnh chất lượng cao JPG -->
            <div class="tab-pane fade" id="jpg-download" role="tabpanel" aria-labelledby="jpg-download-tab">
                <div class="form-container">
                    <h4 class="mb-3">Tải ảnh sản phẩm chất lượng cao (JPG)</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép tải ảnh sản phẩm Autonics với chất lượng cao và lưu dưới định dạng JPG:</p>
                        <ol>
                            <li>Tải ảnh sản phẩm chất lượng cao nhất có thể</li>
                            <li>Lưu trữ dưới định dạng JPG với chất lượng tối ưu</li>
                            <li>Đảm bảo màu sắc, chi tiết và độ sắc nét như ảnh gốc</li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tạo một file <strong>TXT</strong> chứa danh sách mã sản phẩm Autonics (mỗi mã sản phẩm trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Tải file TXT lên hệ thống</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Tải ảnh JPG chất lượng cao" để bắt đầu quá trình tìm kiếm và tải ảnh</p>
                        </div>
                    </div>

                    <form action="/download-jpg-images" method="post" enctype="multipart/form-data" id="jpg-images-form">
                        <label for="jpg_product_code_file" class="file-input-label">
                                <i class="bi bi-file-earmark-text fs-3"></i>
                                <div class="mt-2">File .txt chứa mã sản phẩm</div>
                                <span>Mỗi mã sản phẩm trên một dòng</span>
                                <input type="file" id="jpg_product_code_file" name="product_code_file" class="d-none" accept=".txt" onchange="updateFileName(this, 'jpg_product_code_file_name')">
                        </label>
                        <div id="jpg_product_code_file_name" class="mb-3 text-muted"></div>
                        <button type="submit" class="btn btn-primary w-100">Tải ảnh JPG chất lượng cao</button>
                    </form>
                </div>
            </div>

            <!-- Tab tải tài liệu PDF -->
            <div class="tab-pane fade" id="pdf-download" role="tabpanel" aria-labelledby="pdf-download-tab">
                <div class="form-container">
                    <h4 class="mb-3">Tải tài liệu PDF sản phẩm từ URL BAA.vn</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép tải tất cả tài liệu PDF của sản phẩm từ các URL BAA.vn:</p>
                        <ol>
                            <li>Truy cập trực tiếp vào trang sản phẩm từ URL được cung cấp</li>
                            <li>Trích xuất các link tài liệu PDF từ trang chi tiết sản phẩm</li>
                            <li>Tải toàn bộ tài liệu về với tên gốc</li>
                            <li>Tổ chức tài liệu theo thư mục sản phẩm</li>
                            <li>Dễ dàng truy cập thông tin kỹ thuật và hướng dẫn sử dụng</li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tạo một file <strong>TXT</strong> chứa danh sách các URL sản phẩm từ BAA.vn (mỗi URL trên một dòng)</p>
                            <p class="text-muted">Ví dụ: https://baa.vn/vn/san-pham/bo-chuyen-doi-nhiet-do-autonics-kt-502h0_60329</p>
                        </div>
                        <div class="step">
                            <p>Tải file TXT lên hệ thống</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Tải tài liệu PDF" để bắt đầu quá trình trích xuất và tải tài liệu</p>
                        </div>
                    </div>

                    <form action="/download-documents" method="post" enctype="multipart/form-data" id="pdf-documents-form">
                        <label for="pdf_product_code_file" class="file-input-label">
                                <i class="bi bi-file-earmark-text fs-3"></i>
                                <div class="mt-2">File .txt chứa URL sản phẩm BAA.vn</div>
                                <span>Mỗi URL trên một dòng</span>
                                <input type="file" id="pdf_product_code_file" name="product_code_file" class="d-none" accept=".txt" onchange="updateFileName(this, 'pdf_product_code_file_name')">
                        </label>
                        <div id="pdf_product_code_file_name" class="mb-3 text-muted"></div>
                        <button type="submit" class="btn btn-primary w-100">Tải tài liệu PDF</button>
                    </form>
                </div>
            </div>

            <!-- Tab tải ảnh sản phẩm từ BAA.vn -->
            <div class="tab-pane fade" id="baa-images" role="tabpanel" aria-labelledby="baa-images-tab">
                <div class="form-container">
                    <h4 class="mb-3">Tải ảnh sản phẩm từ BAA.vn</h4>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tạo một file <strong>TXT</strong> chứa danh sách các URL sản phẩm từ BAA.vn (mỗi URL trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Tải file TXT lên hệ thống</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Tải ảnh sản phẩm" để bắt đầu quá trình tải ảnh</p>
                        </div>
                    </div>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <ul>
                            <li>Tự động truy cập vào từng URL sản phẩm</li>
                            <li>Tìm chính xác ảnh gốc kích thước lớn (800px) của sản phẩm:</li>
                            <ul>
                                <li>Ưu tiên ảnh từ <code>img.btn-image-view-360</code> (ảnh chính hiển thị trên trang sản phẩm)</li>
                                <li>Tìm trong cấu trúc modal khi click vào ảnh sản phẩm</li>
                                <li>Tự động chuyển đổi từ kích thước nhỏ sang kích thước lớn (800px)</li>
                            </ul>
                            <li>Trích xuất chính xác mã sản phẩm từ phần tử <code>span.product__symbol__value</code></li>
                            <li>Lưu ảnh với tên là mã sản phẩm của nhà sản xuất (ví dụ: RY42PT1P.webp)</li>
                            <li>Tạo file Excel báo cáo chi tiết kết quả tải ảnh</li>
                        </ul>
                        <div class="alert alert-info mt-3">
                            <i class="bi bi-info-circle-fill me-2"></i> <strong>Cải tiến mới:</strong> Chức năng đã được tối ưu để tìm chính xác ảnh gốc, trích xuất đúng mã sản phẩm từ trang web và đặt tên file theo mã sản phẩm của nhà sản xuất.
                        </div>
                    </div>
                    
                    <form action="{{ url_for('main.download_baa_images') }}" method="post" enctype="multipart/form-data" class="mt-4">
                        <label for="product_links_file" class="file-input-label">
                                <i class="bi bi-file-earmark-text fs-3"></i>
                                <div class="mt-2">File .txt chứa URL sản phẩm</div>
                                <span>Mỗi URL trên một dòng</span>
                                <input type="file" id="product_links_file" name="product_links_file" class="d-none" accept=".txt" required onchange="updateFileName(this, 'product_links_file_name')">
                        </label>
                            <div id="product_links_file_name" class="mb-3 text-muted"></div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-image"></i> Tải ảnh sản phẩm
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Tab tải ảnh sản phẩm từ nhiều danh mục BAA.vn -->
            <div class="tab-pane fade" id="category-baa-images" role="tabpanel" aria-labelledby="category-baa-images-tab">
                <div class="form-container">
                    <h4 class="mb-3">Tải ảnh sản phẩm từ nhiều danh mục BAA.vn</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép tải ảnh sản phẩm từ nhiều danh mục của BAA.vn:</p>
                        <ol>
                            <li>Tự động truy cập vào từng URL danh mục</li>
                            <li>Trích xuất tất cả URL sản phẩm từ mỗi danh mục</li>
                            <li>Tải ảnh sản phẩm với chất lượng cao nhất có thể</li>
                            <li>Tự động sắp xếp ảnh theo danh mục</li>
                            <li>Tạo báo cáo chi tiết cho từng danh mục và báo cáo tổng hợp</li>
                        </ol>
                        <div class="alert alert-info mt-3">
                            <i class="bi bi-info-circle-fill me-2"></i> <strong>Ưu điểm:</strong> Chức năng này giúp tự động hóa hoàn toàn quá trình tải ảnh và tổ chức theo cấu trúc danh mục.
                        </div>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Nhập danh sách các URL danh mục từ BAA.vn (mỗi URL trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Tải ảnh theo danh mục" để bắt đầu quá trình</p>
                        </div>
                        <div class="step">
                            <p>Tải xuống file ZIP chứa ảnh đã được tổ chức theo danh mục</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.download_category_baa_images') }}" method="post" enctype="multipart/form-data" id="category-baa-images-form">
                        <div class="mb-3">
                            <label for="category_urls" class="form-label">Danh sách các URL danh mục BAA.vn (mỗi URL trên một dòng):</label>
                            <textarea id="category_urls" name="category_urls" class="form-control" rows="10" required placeholder="Nhập URL danh mục BAA.vn vào đây...
Ví dụ: https://baa.vn/vn/Category/cam-bien-autonics_1795"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-images"></i> Tải ảnh theo danh mục
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Tab so sánh mã sản phẩm -->
            <div class="tab-pane fade" id="compare-products" role="tabpanel" aria-labelledby="compare-products-tab">
                <div class="form-container">
                    <h4 class="mb-3">So sánh mã sản phẩm giữa hai file Excel</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép so sánh mã sản phẩm từ hai file Excel và phân loại mã trùng lặp và không trùng lặp:</p>
                        <ol>
                            <li>Đọc hai file Excel với mã sản phẩm</li>
                            <li>Phân tích và xác định mã sản phẩm trùng lặp giữa hai file</li>
                            <li>Phân loại mã sản phẩm không trùng lặp (độc nhất ở mỗi file)</li>
                            <li>Tạo file Excel báo cáo với các sheet riêng biệt cho:
                                <ul>
                                    <li>Mã sản phẩm trùng lặp giữa hai file</li>
                                    <li>Mã sản phẩm chỉ có trong file 1</li>
                                    <li>Mã sản phẩm chỉ có trong file 2</li>
                                </ul>
                            </li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tải lên hai file <strong>Excel</strong> chứa mã sản phẩm cần so sánh</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "So sánh mã sản phẩm" để bắt đầu quá trình phân tích</p>
                        </div>
                        <div class="step">
                            <p>Tải xuống file Excel kết quả với các sheet phân loại</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.compare_product_codes') }}" method="post" enctype="multipart/form-data" id="compare-products-form">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="excel_file_1" class="file-input-label">
                                    <i class="bi bi-file-earmark-excel fs-3"></i>
                                        <div class="mt-2">File Excel HPT</div>
                                    <span>Chỉ chấp nhận file .xlsx, .xls, .csv</span>
                                        <input type="file" id="excel_file_1" name="excel_file_1" class="d-none" accept=".xlsx, .xls, .csv" onchange="updateFileName(this, 'excel_file_1_name')">
                                </label>
                                <div id="excel_file_1_name" class="mb-3 text-muted"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="excel_file_2" class="file-input-label">
                                    <i class="bi bi-files fs-3"></i>
                                        <div class="mt-2">Các file Excel cần so sánh</div>
                                    <span>Chọn một hoặc nhiều file .xlsx, .xls, .csv</span>
                                        <input type="file" id="excel_file_2" name="excel_file_2" class="d-none" accept=".xlsx, .xls, .csv" multiple onchange="updateMultipleFileNames(this, 'excel_file_2_names')">
                                </label>
                                <div id="excel_file_2_names" class="mb-3 text-muted"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="categorize_results" name="categorize_results">
                                <label class="form-check-label" for="categorize_results">
                                    <i class="bi bi-folder-symlink"></i> Phân loại kết quả theo danh mục sản phẩm (Cảm biến, Thị giác máy, v.v...)
                                </label>
                                <div class="form-text">
                                    Tùy chọn này sẽ tạo các sheet riêng cho từng danh mục sản phẩm, giúp dễ dàng quản lý và sắp xếp
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">So sánh mã sản phẩm</button>
                    </form>
                </div>
            </div>
            
            <!-- Tab lọc mã sản phẩm -->
                <div class="tab-pane fade {% if active_tab == 'filter-products-tab' %}show active{% endif %}" id="filter-products" role="tabpanel" aria-labelledby="filter-products-tab">
                <div class="form-container">
                    <h4 class="mb-3">Lọc mã sản phẩm từ file Excel</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép lọc các mã sản phẩm khỏi file Excel:</p>
                        <ol>
                            <li>Nhập danh sách mã sản phẩm cần xóa (mỗi mã trên một dòng)</li>
                            <li>Tải lên file Excel chứa dữ liệu sản phẩm</li>
                            <li>Hệ thống sẽ tự động xóa các dòng có mã sản phẩm (cột B) trùng với danh sách đã nhập</li>
                                <li>Danh sách mã đã lọc sẽ được thêm vào cột C (dòng đầu tiên)</li>
                            <li>Tạo file Excel mới với các sheet:
                                <ul>
                                    <li>Dữ liệu đã lọc: chứa dữ liệu sau khi đã xóa các mã</li>
                                    <li>Mã đã xóa: chứa danh sách các dòng đã bị xóa</li>
                                    <li>Tổng hợp: báo cáo số lượng dữ liệu trước và sau khi lọc</li>
                                </ul>
                            </li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Nhập danh sách mã sản phẩm cần xóa (mỗi mã một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Tải lên file <strong>Excel</strong> chứa dữ liệu sản phẩm (mã sản phẩm ở cột B)</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Lọc mã sản phẩm" để tiến hành xử lý</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.filter_products') }}" method="post" enctype="multipart/form-data" id="filter-products-form">
                        <div class="mb-3">
                            <label for="product_codes" class="form-label">Danh sách mã sản phẩm cần xóa (mỗi mã một dòng):</label>
                            <textarea id="product_codes" name="product_codes" class="form-control" rows="10" required placeholder="Nhập mã sản phẩm vào đây..."></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="excel_file" class="file-input-label">
                                    <i class="bi bi-file-earmark-excel"></i>
                                <div class="mt-2">File Excel chứa dữ liệu sản phẩm</div>
                                <span>Chỉ chấp nhận file .xlsx, .xls</span>
                                    <input type="file" id="excel_file" name="excel_file" class="d-none" accept=".xlsx, .xls" required onchange="updateFileName(this, 'excel_file_name')">
                            </label>
                                <div id="excel_file_name" class="mb-3"></div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-funnel"></i> Lọc mã sản phẩm
                        </button>
                    </form>
                </div>
            </div>
                
                <!-- Tab lọc theo loại -->
                <div class="tab-pane fade {% if active_tab == 'filter-product-types-tab' %}show active{% endif %}" id="filter-product-types" role="tabpanel" aria-labelledby="filter-product-types-tab">
                    <div class="form-container">
                        <h4 class="mb-3">Lọc sản phẩm theo loại</h4>
                        
                        <div class="data-format">
                            <h5>Thông tin về chức năng</h5>
                            <p>Chức năng này cho phép lọc sản phẩm theo loại (như cảm biến tiệm cận, sợi quang, quang điện, ...):</p>
                            <ol>
                                <li>Chọn các loại sản phẩm cần lọc từ danh sách</li>
                                <li>Tải lên file Excel chứa dữ liệu sản phẩm</li>
                                <li>Hệ thống sẽ tự động tìm và lọc các sản phẩm thuộc loại đã chọn</li>
                                <li>Kết quả sẽ được xuất ra file Excel mới với các sheet:
                                    <ul>
                                        <li>Sheet riêng cho mỗi loại sản phẩm đã chọn</li>
                                        <li>Sheet "Tất cả" chứa tổng hợp tất cả sản phẩm đã lọc</li>
                                        <li>Sheet "Tổng kết" báo cáo số lượng sản phẩm của mỗi loại</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                        
                        <div class="steps">
                            <div class="step">
                                <p>Chọn các loại sản phẩm cần lọc</p>
                            </div>
                            <div class="step">
                                <p>Tải lên file <strong>Excel</strong> chứa dữ liệu sản phẩm</p>
                            </div>
                            <div class="step">
                                <p>Nhấn nút "Lọc theo loại" để tiến hành xử lý</p>
                            </div>
                        </div>

                        <form action="{{ url_for('main.filter_product_types') }}" method="post" enctype="multipart/form-data" id="filter-product-types-form">
                            <div class="mb-3">
                                <label class="form-label">Chọn các loại sản phẩm cần lọc:</label>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="product_types" id="type_tiem_can" value="tiem_can">
                                            <label class="form-check-label" for="type_tiem_can">Tiệm cận</label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="product_types" id="type_soi_quang" value="soi_quang">
                                            <label class="form-check-label" for="type_soi_quang">Sợi quang</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="product_types" id="type_quang_dien" value="quang_dien">
                                            <label class="form-check-label" for="type_quang_dien">Quang điện</label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="product_types" id="type_vung_kv" value="vung_kv">
                                            <label class="form-check-label" for="type_vung_kv">Vùng (khu vực)</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="product_types" id="type_ap_suat" value="ap_suat">
                                            <label class="form-check-label" for="type_ap_suat">Áp suất</label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="product_types" id="type_luu_luong" value="luu_luong">
                                            <label class="form-check-label" for="type_luu_luong">Lưu lượng</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-4">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="product_types" id="type_xy_lanh" value="xy_lanh">
                                            <label class="form-check-label" for="type_xy_lanh">Xy lanh</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="product_types" id="type_dien_dung" value="dien_dung">
                                            <label class="form-check-label" for="type_dien_dung">Điện dung</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="excel_file" class="file-input-label">
                                    <i class="bi bi-file-earmark-excel"></i>
                                    <div class="mt-2">File Excel chứa dữ liệu sản phẩm</div>
                                    <span>Chỉ chấp nhận file .xlsx, .xls</span>
                                    <input type="file" id="excel_file" name="excel_file" class="d-none" accept=".xlsx, .xls" required onchange="updateFileName(this, 'excel_file_name_filter_types')">
                                </label>
                                <div id="excel_file_name_filter_types" class="mb-3"></div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-funnel"></i> Lọc theo loại
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Tab trích xuất giá sản phẩm -->
            <div class="tab-pane fade" id="extract-prices" role="tabpanel" aria-labelledby="extract-prices-tab">
                <div class="form-container">
                    <h4 class="mb-3">Trích xuất giá sản phẩm từ danh sách URL</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép trích xuất giá sản phẩm từ danh sách URL:</p>
                        <ol>
                            <li>Tải lên file TXT chứa danh sách các URL sản phẩm (mỗi URL trên một dòng)</li>
                            <li>Hệ thống sẽ truy cập từng URL và trích xuất: Mã sản phẩm, Tên sản phẩm và Giá</li>
                            <li>Tất cả thông tin được xuất ra file Excel để dễ dàng sử dụng</li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tạo một file <strong>TXT</strong> chứa danh sách các URL sản phẩm (mỗi URL trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Tải file TXT lên hệ thống</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Trích xuất giá" để bắt đầu quá trình</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.extract_prices') }}" method="post" enctype="multipart/form-data" id="extract-prices-form">
                        <div class="mb-3">
                            <label for="product_links_file" class="file-input-label">
                                <i class="bi bi-file-earmark-text fs-3"></i>
                                    <div class="mt-2">File .txt chứa URL sản phẩm</div>
                                    <span>Mỗi URL trên một dòng</span>
                                    <input type="file" id="product_links_file" name="product_links_file" class="d-none" accept=".txt" required onchange="updateFileName(this, 'product_links_file_name')">
                            </label>
                            <div id="product_links_file_name" class="mb-3 text-muted"></div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-currency-exchange"></i> Trích xuất giá
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Tab chỉ lấy giá sản phẩm -->
            <div class="tab-pane fade" id="extract-only-prices" role="tabpanel" aria-labelledby="extract-only-prices-tab">
                <div class="form-container">
                    <h4 class="mb-3">Chỉ lấy giá sản phẩm từ danh sách URL</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này chỉ trích xuất mã sản phẩm và giá từ danh sách URL (nhanh hơn chức năng trích xuất đầy đủ):</p>
                        <ol>
                            <li>Tải lên file TXT chứa danh sách các URL sản phẩm (mỗi URL trên một dòng)</li>
                            <li>Hệ thống sẽ truy cập từng URL và chỉ trích xuất mã sản phẩm và giá</li>
                            <li>Kết quả được xuất ra file Excel gọn nhẹ, thuận tiện cho việc tra cứu giá</li>
                        </ol>
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> Tính năng này được tối ưu hóa để lấy giá nhanh hơn, phù hợp với việc khảo sát giá.
                        </div>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tạo một file <strong>TXT</strong> chứa danh sách các URL sản phẩm (mỗi URL trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Tải file TXT lên hệ thống</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Lấy giá sản phẩm" để bắt đầu quá trình</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.extract_only_prices') }}" method="post" enctype="multipart/form-data" id="extract-only-prices-form">
                        <div class="mb-3">
                            <label for="product_links_file_prices" class="file-input-label">
                                <i class="bi bi-file-earmark-text fs-3"></i>
                                    <div class="mt-2">File .txt chứa URL sản phẩm</div>
                                    <span>Mỗi URL trên một dòng</span>
                                    <input type="file" id="product_links_file_prices" name="product_links_file" class="d-none" accept=".txt" required onchange="updateFileName(this, 'product_links_file_prices_name')">
                            </label>
                            <div id="product_links_file_prices_name" class="mb-3 text-muted"></div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-cash-coin"></i> Lấy giá sản phẩm
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tab cào nhiều danh mục (Liên kết) -->
            <div class="tab-pane fade" id="category-extract" role="tabpanel" aria-labelledby="category-extract-tab">
                <div class="form-container">
                    <h4 class="mb-3">Cào nhiều danh mục (Liên kết)</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép cào nhiều danh mục và thu thập liên kết sản phẩm từ các danh mục đó:</p>
                        <ol>
                            <li>Nhập danh sách các URL danh mục (mỗi URL trên một dòng)</li>
                            <li>Hệ thống sẽ tự động cào thông tin sản phẩm từ các danh mục đó</li>
                            <li>Lưu trữ các liên kết sản phẩm vào file Excel</li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Nhập danh sách các URL danh mục (mỗi URL trên một dòng)</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Cào nhiều danh mục" để bắt đầu quá trình</p>
                        </div>
                        <div class="step">
                            <p>Tải xuống file Excel chứa các liên kết sản phẩm</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.extract_category_links_separate') }}" method="post" enctype="multipart/form-data" id="category-extract-form">
                        <div class="mb-3">
                            <label for="category_urls" class="form-label">Danh sách các URL danh mục (mỗi URL trên một dòng):</label>
                            <textarea id="category_urls" name="category_urls" class="form-control" rows="10" required placeholder="Nhập URL danh mục vào đây..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-folder-plus"></i> Cào nhiều danh mục
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tab cào nhiều danh mục (Dữ liệu) -->
            <div class="tab-pane fade" id="category-scrape" role="tabpanel" aria-labelledby="category-scrape-tab">
                <div class="form-container">
                    <h4 class="mb-3">Cào dữ liệu baa.vn</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép cào nhiều danh mục baa.vn và thu thập đầy đủ thông tin sản phẩm (bao gồm tên, mã, giá, thông số kỹ thuật và ảnh sản phẩm):</p>
                        <ol>
                            <li>Nhập danh sách các URL danh mục từ <strong>baa.vn</strong> (mỗi URL trên một dòng)</li>
                            <li>Hệ thống sẽ áp dụng <strong>xử lý đa luồng</strong> để tự động cào tất cả thông tin sản phẩm và ảnh</li>
                            <li>Kết quả được tổ chức theo từng danh mục và nén thành file ZIP</li>
                        </ol>
                        <div class="alert alert-info mt-3">
                            <i class="bi bi-info-circle-fill me-2"></i> <strong>Tính năng mới:</strong> Chức năng này sử dụng <strong>đa luồng</strong> để tăng tốc xử lý và tự động tải ảnh sản phẩm từ baa.vn.
                        </div>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Nhập danh sách các URL danh mục baa.vn (mỗi URL trên một dòng)</p>
                            <p class="text-muted">Ví dụ: https://baa.vn/vn/Category/cam-bien-autonics_1795</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Cào dữ liệu baa.vn" để bắt đầu quá trình</p>
                        </div>
                        <div class="step">
                            <p>Tải xuống file ZIP chứa đầy đủ thông tin sản phẩm và ảnh đã được tổ chức theo danh mục</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.scrape_category_products') }}" method="post" enctype="multipart/form-data" id="category-scrape-form">
                        <div class="mb-3">
                            <label for="category_urls_scrape" class="form-label">Danh sách các URL danh mục baa.vn (mỗi URL trên một dòng):</label>
                            <textarea id="category_urls_scrape" name="category_urls" class="form-control" rows="10" required placeholder="Nhập URL danh mục baa.vn vào đây...
Ví dụ: https://baa.vn/vn/Category/cam-bien-autonics_1795"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-folder-symlink"></i> Cào dữ liệu baa.vn
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tab cào dữ liệu từ Codienhaiau.com -->
            <div class="tab-pane fade" id="codienhaiau-crawler" role="tabpanel" aria-labelledby="codienhaiau-crawler-tab">
                <div class="form-container">
                    <h4 class="mb-3">Cào dữ liệu sản phẩm từ Codienhaiau.com</h4>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Nhập danh sách các URL danh mục chính từ Codienhaiau.com (mỗi URL trên một dòng)</p>
                            <p class="text-muted">Ví dụ: https://codienhaiau.com/category/keyence/cam-bien-keyence/</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Cào dữ liệu" để bắt đầu quá trình</p>
                        </div>
                        <div class="step">
                            <p>Theo dõi tiến trình cào dữ liệu trực tiếp trong terminal</p>
                        </div>
                    </div>
                    
                    <form action="{{ url_for('main.crawl_codienhaiau') }}" method="post" enctype="multipart/form-data" id="codienhaiau-crawler-form">
                        <div class="mb-3">
                            <label for="codienhaiau_urls" class="form-label">Danh sách các URL danh mục Codienhaiau.com:</label>
                            <textarea id="codienhaiau_urls" name="category_urls" class="form-control" rows="5" required placeholder="Nhập URL danh mục Codienhaiau.com vào đây... (mỗi URL một dòng)"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-cloud-download"></i> Cào dữ liệu
                        </button>
                    </form>
                    </div>
                </div>
            
            <!-- Tab cào dữ liệu từ BAA.vn -->
            <div class="tab-pane fade" id="baa-crawler" role="tabpanel" aria-labelledby="baa-crawler-tab">
                <div class="form-container">
                    <h4 class="mb-3">Cào dữ liệu sản phẩm từ BAA.vn</h4>
                    
                    <!-- Thêm nút debug -->
                    <div class="card mb-3">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">Debug - Kiểm tra URL</h5>
                        </div>
                        <div class="card-body">
                            <p>Sử dụng để kiểm tra và debug việc trích xuất sản phẩm từ một URL cụ thể:</p>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="debug-url" placeholder="Nhập URL để debug..." value="https://baa.vn/vn/Category/thi-giac-may-3d-cognex_531_2603/">
                                <button class="btn btn-warning" type="button" onclick="debugExtractProducts()">
                                    <i class="bi bi-bug"></i> Debug URL
                                </button>
                            </div>
                            <div id="debug-results" class="mt-3" style="display: none;">
                                <h6>Kết quả debug:</h6>
                                <pre id="debug-output" class="bg-light p-3" style="max-height: 300px; overflow-y: auto;"></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Cào dữ liệu BAA.vn</h5>
                        </div>
                        <div class="card-body">
                            <form action="{{ url_for('main.crawl_baa') }}" method="post">
                                <div class="form-group">
                                    <label for="category_urls">Nhập URL danh mục hoặc sản phẩm (<b>mỗi URL một dòng</b>):</label>
                                    <textarea class="form-control" id="category_urls" name="category_urls" rows="5" required></textarea>
                                    <small class="form-text text-muted">Ví dụ: https://baa.vn/camera-lapara, https://baa.vn/chuong-hinh-hikvision</small>
                                </div>
                                
                                <!-- Thêm tùy chọn nâng cao -->
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="max_workers">Số luồng tối đa:</label>
                                        <select class="form-control" id="max_workers" name="max_workers">
                                            <option value="4">4 luồng (máy yếu)</option>
                                            <option value="8" selected>8 luồng (mặc định)</option>
                                            <option value="12">12 luồng (máy tốt)</option>
                                            <option value="16">16 luồng (máy mạnh)</option>
                                        </select>
                                        <small class="form-text text-muted">Nhiều luồng hơn tăng tốc xử lý nhưng yêu cầu máy tính mạnh hơn</small>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="max_retries">Số lần thử lại tối đa:</label>
                                        <select class="form-control" id="max_retries" name="max_retries">
                                            <option value="1">1 lần (nhanh nhất)</option>
                                            <option value="3" selected>3 lần (mặc định)</option>
                                            <option value="5">5 lần (chính xác cao)</option>
                                        </select>
                                        <small class="form-text text-muted">Nhiều lần thử lại nếu mạng không ổn định</small>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">Bắt đầu cào dữ liệu</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab phân loại sản phẩm theo danh mục -->
            <div class="tab-pane fade" id="categorize-products" role="tabpanel" aria-labelledby="categorize-products-tab">
                <div class="form-container">
                    <h4 class="mb-3">Phân loại sản phẩm theo danh mục</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này cho phép phân loại sản phẩm theo danh mục và xuất ra file Excel có nhiều sheet riêng biệt:</p>
                        <ol>
                            <li>Tải lên file Excel/CSV chứa dữ liệu sản phẩm với cột "Danh mục" và thông tin sản phẩm</li>
                            <li>Hệ thống sẽ tự động phân loại sản phẩm dựa trên danh mục</li>
                            <li>Xuất file Excel mới với các sheet riêng biệt cho từng danh mục sản phẩm</li>
                            <li>Hỗ trợ các danh mục chuẩn như: Cảm biến quang, Cảm biến áp suất, Cảm biến lưu lượng, Cảm biến tiệm cận, v.v.</li>
                            <li>Các sản phẩm không thuộc danh mục chuẩn sẽ được lưu vào sheet "Khác"</li>
                        </ol>
                        <div class="alert alert-info mt-3">
                            <i class="bi bi-info-circle-fill me-2"></i> <strong>Lợi ích:</strong> Giúp quản lý sản phẩm có cấu trúc, dễ dàng theo dõi từng nhóm sản phẩm riêng biệt.
                        </div>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Tải lên file <strong>Excel/CSV</strong> chứa dữ liệu sản phẩm với cột "Danh mục"</p>
                        </div>
                        <div class="step">
                            <p>Chọn thư mục đầu ra để lưu file Excel kết quả</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Phân loại sản phẩm" để bắt đầu quá trình</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.categorize_products') }}" method="post" enctype="multipart/form-data" id="categorize-products-form">
                        <div class="mb-3">
                            <label for="product_file" class="file-input-label">
                                <i class="bi bi-file-earmark-excel fs-3"></i>
                                <div class="mt-2">File dữ liệu sản phẩm</div>
                                <span>Chỉ chấp nhận file .xlsx, .xls, .csv</span>
                                <input type="file" id="product_file" name="product_file" class="d-none" accept=".xlsx, .xls, .csv" required onchange="updateFileName(this, 'product_file_name')">
                            </label>
                            <div id="product_file_name" class="mb-3 text-muted"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="output_dir" class="form-label">Thư mục đầu ra (không bắt buộc):</label>
                            <input type="text" id="output_dir" name="output_dir" class="form-control" placeholder="Để trống nếu muốn lưu vào thư mục mặc định">
                            <small class="text-muted">Nếu không chọn, file sẽ được lưu vào thư mục mặc định 'output'</small>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-diagram-3"></i> Phân loại sản phẩm
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tab upscale ảnh bằng Real-ESRGAN -->
            <div class="tab-pane fade {% if active_tab == 'image-upscale-tab' %}show active{% endif %}" id="image-upscale" role="tabpanel" aria-labelledby="image-upscale-tab">
                <div class="form-container">
                    <h4 class="mb-3">Nâng cao chất lượng ảnh bằng AI (Real-ESRGAN)</h4>
                    
                    <div class="data-format">
                        <h5>Thông tin về chức năng</h5>
                        <p>Chức năng này sử dụng công nghệ AI tiên tiến (Real-ESRGAN) để nâng cao chất lượng và độ phân giải của ảnh:</p>
                        <ol>
                            <li>Sử dụng <strong>AI Real-ESRGAN</strong> để khôi phục chi tiết và nâng cao chất lượng ảnh</li>
                            <li>Tự động chuyển đổi ảnh thành kích thước <strong>600x600 pixel</strong> với chất lượng cao</li>
                            <li>Giữ nguyên tỷ lệ khung hình gốc, không bị méo ảnh</li>
                            <li>Tối ưu độ sắc nét, không bị vỡ ảnh</li>
                            <li>Lưu kết quả với định dạng WebP tối ưu cho web</li>
                        </ol>
                    </div>
                    
                    <div class="steps">
                        <div class="step">
                            <p>Chọn ảnh cần nâng cao chất lượng</p>
                        </div>
                        <div class="step">
                            <p>Nhấn nút "Nâng cao chất lượng ảnh" để bắt đầu quá trình</p>
                        </div>
                        <div class="step">
                            <p>Tải xuống ảnh kết quả với kích thước 600x600 pixel, giữ nguyên độ sắc nét</p>
                        </div>
                    </div>

                    <form action="{{ url_for('main.upscale_image') }}" method="post" enctype="multipart/form-data" id="upscale-image-form">
                        <label for="input_image" class="file-input-label">
                            <i class="bi bi-image fs-3"></i>
                            <div class="mt-2">Chọn ảnh cần nâng cao chất lượng</div>
                            <span>Chấp nhận định dạng .jpg, .jpeg, .png, .webp</span>
                            <input type="file" id="input_image" name="input_image" class="d-none" accept=".jpg,.jpeg,.png,.webp" required onchange="updateFileName(this, 'input_image_name')">
                        </label>
                        <div id="input_image_name" class="mb-3 text-muted"></div>
                        
                        <div class="alert alert-info mb-3">
                            <i class="bi bi-info-circle-fill"></i> Ảnh sẽ được chuyển đổi thành kích thước <strong>600x600 pixel</strong> với chất lượng tối ưu.
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-image-alt"></i> Nâng cao chất lượng ảnh
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Dữ liệu từ Jinja -->
    <div id="template-data" 
        data-active-tab="{{ active_tab|default('') }}"
        data-has-success-message="{% if success_message %}true{% else %}false{% endif %}">
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    
    <script>
        // Xử lý khi tài liệu đã tải xong
        document.addEventListener('DOMContentLoaded', function() {
            // Lấy dữ liệu từ template
            const templateData = document.getElementById('template-data');
            const activeTab = templateData.dataset.activeTab;
            const hasSuccessMessage = templateData.dataset.hasSuccessMessage === 'true';
            
            // Kích hoạt tab được chỉ định
            if (activeTab) {
                activateTab(activeTab);
            }
            
            // Kiểm tra trạng thái tiến trình
            const socket = io();
            socket.on('progress_update', function(data) {
                const progressBar = document.getElementById('progress-bar');
                const progressMessage = document.getElementById('progress-message');
                const progressDetail = document.getElementById('progress-detail');
                const progressContainer = document.getElementById('progress-container');
                
                progressContainer.classList.remove('d-none');
                progressBar.style.width = data.percent + '%';
                progressBar.setAttribute('aria-valuenow', data.percent);
                progressMessage.textContent = data.message;
                
                if (data.detail) {
                    progressDetail.textContent = data.detail;
                    progressDetail.classList.remove('d-none');
                } else {
                    progressDetail.classList.add('d-none');
                }
                
                // Thay đổi màu sắc thanh tiến trình dựa vào tiến độ
                if (data.percent < 30) {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-info';
                } else if (data.percent < 70) {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-primary';
                } else if (data.percent < 100) {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-success';
                } else {
                    progressBar.className = 'progress-bar bg-success';
                }
                
                // Tự động cuộn đến thanh tiến trình
                progressContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });
            
            // Hiển thị thông báo thành công trong 5 giây
            if (hasSuccessMessage) {
                setTimeout(function() {
                    const alert = document.getElementById('success-alert');
                    if (alert) {
                        alert.style.display = 'none';
                    }
                }, 5000);
            }
        });

        function updateFileName(input, outputId) {
            const output = document.getElementById(outputId);
            if (input.files && input.files[0]) {
                output.textContent = "Đã chọn: " + input.files[0].name;
            } else {
                output.textContent = "";
            }
        }
        
        function updateFileNameMultiple(input, outputId) {
            const output = document.getElementById(outputId);
            if (input.files && input.files.length > 0) {
                output.textContent = "Đã chọn: " + input.files.length + " file";
            } else {
                output.textContent = "";
            }
        }
        
        function updateMultipleFileNames(input, outputId) {
            const output = document.getElementById(outputId);
            if (input.files && input.files.length > 0) {
                let fileList = "";
                if (input.files.length <= 5) {
                    // Hiển thị tất cả tên file nếu ít hơn 5 file
                    for (let i = 0; i < input.files.length; i++) {
                        fileList += (i + 1) + ". " + input.files[i].name + "<br>";
                    }
                } else {
                    // Hiển thị 3 file đầu tiên và thông báo số file còn lại
                    for (let i = 0; i < 3; i++) {
                        fileList += (i + 1) + ". " + input.files[i].name + "<br>";
                    }
                    fileList += "... và " + (input.files.length - 3) + " file khác";
                }
                output.innerHTML = "<strong>Đã chọn " + input.files.length + " file:</strong><br>" + fileList;
            } else {
                output.textContent = "";
            }
        }
        
        // Kích hoạt tab
        function activateTab(tabId) {
            const tab = document.querySelector('button[id="' + tabId + '"]');
            if (tab) {
                const bsTab = new bootstrap.Tab(tab);
                bsTab.show();
            }
        }
        
        // Hàm debug để kiểm tra việc trích xuất sản phẩm
        function debugExtractProducts() {
            const urlInput = document.getElementById('debug-url');
            const debugResults = document.getElementById('debug-results');
            const debugOutput = document.getElementById('debug-output');
            
            const url = urlInput.value.trim();
            if (!url) {
                alert('Vui lòng nhập URL để debug');
                return;
            }
            
            // Hiển thị loading
            debugOutput.textContent = 'Đang xử lý debug...';
            debugResults.style.display = 'block';
            
            // Gọi API debug
            fetch('/debug-extract-products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ url: url })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const output = `URL: ${data.url}
Số sản phẩm tìm thấy: ${data.product_count}
                    
Danh sách URL sản phẩm (tối đa 20):
${data.product_links.map((link, index) => `${index + 1}. ${link}`).join('\n')}

Message: ${data.message}`;
                    debugOutput.textContent = output;
                } else {
                    debugOutput.textContent = `Lỗi: ${data.error}\n\nChi tiết:\n${data.details || 'Không có chi tiết'}`;
                }
            })
            .catch(error => {
                debugOutput.textContent = `Lỗi kết nối: ${error.message}`;
            });
        }
    </script>
</body>
</html> 